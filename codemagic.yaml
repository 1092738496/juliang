workflows:
  build-macos-app-and-dmg:
    name: Build macOS app + dmg for è¶Šè¿›åˆ›å®¢
    environment:
      flutter: stable
      xcode: latest
    scripts:
      - name: Clean & get dependencies
        script: |
          flutter clean
          flutter pub get

      - name: Build macOS App
        script: |
          flutter build macos --release

      - name: Copy and rename .app to è¶Šè¿›åˆ›å®¢.app
        script: |
          APP_NAME="è¶Šè¿›åˆ›å®¢"
          BUILD_PATH="build/macos/Build/Products/Release"
          ORIGINAL_APP_PATH="${BUILD_PATH}/demo.app"
          TARGET_APP_PATH="${BUILD_PATH}/${APP_NAME}.app"

          echo "ğŸ›  æ£€æŸ¥æ„å»ºäº§ç‰©æ˜¯å¦å­˜åœ¨ï¼š$ORIGINAL_APP_PATH"
          if [ ! -d "$ORIGINAL_APP_PATH" ]; then
            echo "âŒ æœªæ‰¾åˆ° $ORIGINAL_APP_PATH"
            ls -lh ${BUILD_PATH}
            exit 1
          fi

          cp -R "$ORIGINAL_APP_PATH" "$TARGET_APP_PATH"

      - name: Create .dmg (æœªç­¾å)
        script: |
          APP_NAME="è¶Šè¿›åˆ›å®¢"
          BUILD_PATH="build/macos/Build/Products/Release"
          DMG_NAME="${APP_NAME}_unsigned.dmg"

          mkdir -p dmg_temp
          cp -R "${BUILD_PATH}/${APP_NAME}.app" dmg_temp/
          hdiutil create "$DMG_NAME" -volname "$APP_NAME" -srcfolder dmg_temp -ov -format UDZO

      - name: Output artifacts
        script: |
          echo "âœ… æ‰“åŒ…å®Œæˆï¼š"
          ls -lh build/macos/Build/Products/Release/è¶Šè¿›åˆ›å®¢.app
          ls -lh è¶Šè¿›åˆ›å®¢_unsigned.dmg

    artifacts:
      - build/macos/Build/Products/Release/è¶Šè¿›åˆ›å®¢.app
      - è¶Šè¿›åˆ›å®¢_unsigned.dmg
